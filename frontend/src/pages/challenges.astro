---
import { isError, challenges, getEvent } from "../api";
import Challenge from "../components/Challenge.svelte";
import Countdown from "../components/Countdown.svelte";
import Layout from "../layouts/Layout.astro";

let challs;
const event = await getEvent();
if (new Date().getTime() >= event.start_time.getTime()) {
  challs = await challenges(Astro.cookies.get("token")?.value);
  if (isError(challs)) {
    if (challs.error === "invalid_token") return Astro.redirect("/login", 307);
    else return new Response("something went wrong");
  }
}
---

<Layout>
  {
    challs ? (
      <div class="challenges">
        {challs.map((c) => (
          <Challenge chall={c} client:idle />
        ))}
      </div>
    ) : (
      <Countdown {event} client:idle />
    )
  }
</Layout>

<style>
  .challenges {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
</style>
